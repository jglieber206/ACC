<!DOCTYPE html>
<html ng-app="accApp">
<head>
  <title>Projects list</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js"></script>
  <script>
    var accApp = angular.module('accApp', []);
    accApp.controller('ProjectCtrl', function ($scope, $http, $timeout) {
      $http.get('/projects').
        then(function(response) {
          $scope.projects = response.data
        });

      $scope.openProject = function(id) {
        $http.get('/projects/' + id).
        then(function(response) { $scope.project = response.data })
      };

      $scope.deleteProject = function(id) {
        $http.delete('/projects/' + id).
        then(function() { $http.get('/projects')}.
                then(function(response) { $scope.projects = response.data }))
      };

      // $scope.$watch.currentProject = ""
//      $scope.$watch('$scope.currentProjectId', function(newVal, oldVal) {
//        $http.get('/projects/' + $scope.currentProjectId).
//          then(function(response) {
//            $scope.project = response.data
//          })
//      })
      // function to take project id & set to variable to pass into get url
      // $scope.getProj = function(project) {
      //   {{project.id}}
      // }
      // $http.post('/projects').
      //   then(function(newProj) {
      //     $scope.projects << newProj
      //   })
    });

  </script>
</head>
<body>
  <div class="sidebar" ng-controller="ProjectCtrl">
    <h2>Project list</h2>
    <table class="list">
      <tr ng-repeat="project in projects">
        <th><a href="" ng-click="openProject(project.id)">{{project.title}}</a></th>
        <td><a href="" ng-click="deleteProject(project.id)">Delete</a></td>
      </tr>
      <tr>
        <th colspan="2">Add</th>
      </tr>
    </table>
  </div>
  <div class="project" ng-controller="ProjectCtrl">
    <h1>{{project.title}}</h1>
    <table id="grid">
      <script>
        var grid = "<tr><th>&nbsp</th>"
        grid += "<th ng-repeat=\"attribute in project.attributes\">{{attribute.name}}</th></tr>"
        grid += "<tr ng-repeat=\"component in project.components\"><th>{{component.name}}</th><th ng-repeat=\"attribute in project.attributes\">&nbsp</th></tr>"
        document.getElementById("grid").innerHTML = grid;
      </script>
    </table>
  </div>
</body>
</html>
